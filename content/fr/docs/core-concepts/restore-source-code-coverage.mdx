# Restauration de la couverture du code source

Les applications frontend ont diverses formes de compilation. Dans de nombreux cas, l'AST prétraité est transmis à Babel pour conversion, ce qui rend impossible le mappage direct de la couverture au code source. Par conséquent, nous devons restaurer la couverture du code source.

## Source Map

>
> Dans le développement frontend, le code JavaScript est généralement compressé, obfusqué ou converti à l'aide de prétraiteurs (comme TypeScript, Babel) pour améliorer les performances et la compatibilité. Ces traitements rendent le code final déployé en production très différent du code source original, rendant le débogage difficile. Source Map résout ce problème en enregistrant les relations de mappage entre le code compilé et le code original, permettant aux développeurs de visualiser et de déboguer le code original dans les outils de développement du navigateur. -- [web.dev](https://web.dev/articles/source-maps)

Dans la plupart des cas, vous n'avez pas besoin d'obtenir manuellement les fichiers sourceMap, car la plupart des outils de construction transmettent les fichiers sourceMap pendant le processus de "transmission de l'AST prétraité à Babel pour conversion".

Cependant, dans certains cas, vous devrez peut-être configurer les fichiers sourceMap.

## Cas où l'option sourceMap doit être activée

```js filename="webpack.config.js" {4}
const path = require('path');

module.exports = {
  entry: './build/main.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  },
  module:{
    rules: [
      {
        test: /\.(js|jsx)$/,
        use:['babel-loader'],
        exclude:'/node_modules/'
      }
    ]
  }
};
```

Dans cet exemple, le fichier d'entrée de webpack est `./build/main.js`, qui est le produit de la compilation de fichiers ts par tsc. Nous devons définir `sourceMap` sur `true` dans tsconfig.json pour __assurer le transfert des données sourceMap.__

```json filename="tsconfig.json" {3}
{
  "compilerOptions": {
    "sourceMap": true
  }
}
```

## Cas où le sourceMap doit être configuré manuellement

Vous devez configurer manuellement le sourceMap lorsque celui-ci est généré dans les cas suivants :

| Catégorie              | devtool                       | Description                                    |
|-------------------|-------------------------------|-----------------------------------------|
| Générer un fichier source map, ne pas afficher le code source   | hidden-source-map             | Ne pas référencer le fichier map à la fin du fichier                 |
| Générer un fichier source map, ne pas afficher le code source   | nosources-source-map           | Ne pas référencer le fichier map à la fin du fichier                 |

### Comment configurer manuellement le sourceMap

Dans ce cas, vous devez utiliser [Séparation des hit et map](/docs/core-concepts/separate-hit-and-map), et détecter les fichiers sourceMap locaux pendant la phase de construction via `canyon-uploader`. Canyon les appariera avec les données initiales de couverture et les téléchargera.

> [!NOTE]
>
> C'est peut-être l'un des inconvénients de la flexibilité excessive de JavaScript. Pour collecter des données précises de couverture du code source, nous devons relier ces fichiers sourceMap pour que l'instrumentation du code puisse mapper correctement au code source.
