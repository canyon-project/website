import { Callout } from "nextra/components";

# Séparation des hit et map

Collecte des fichiers sources de couverture initiale générés par la compilation Babel dans CI

## Raisons

1. **Collecte complète des fichiers participant à la compilation** : Pendant le processus de post-compilation, le plugin `babel-plugin-canyon` analyse et résout
   chaque fichier initial de couverture des fichiers participant à la compilation, et les enregistre dans le dossier `.canyon_out`.

2. **Collecte précoce pour réduire la pression** : Si vous ne rapportez pas les fichiers de couverture initiale, tous ces fichiers de couverture seront rapportés lors des tests d'automatisation UI,
   ce qui générera une pression de transmission énorme. La collecte précoce peut réduire la pression de transmission de plus de 90%.

> [!TIP]
>
> Ce n'est pas obligatoire, mais si vous avez besoin de collecter des données de couverture précises et stables, nous recommandons vivement de le configurer.

## Rapporter les données de couverture initiale

Le plugin babel-plugin-canyon génère des fichiers de couverture originaux des fichiers participant à la compilation pendant la compilation et les enregistre dans le dossier .canyon_output. Nous fournissons un outil en ligne de commande canyon-uploader que vous pouvez utiliser pour les rapporter au serveur Canyon dans CI.

```yml filename=".github/workflows/report-canyon-output.yml" {19,20} copy
name: Report Canyon Output

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18" # Vous pouvez modifier la version de Node.js selon les besoins de votre projet
      - name: Install dependencies
        run: npm install
      - name: Generate output
        run: npm run build

      # Rapporter le contenu du dossier .canyon_output
      - name: Report output
        run: canyon-uploader map --dsn=https://canyonjs.org
```

## Mettre à jour le plugin Babel

Configurez l'option keepMap sur false

```js filename="babel.config.js" {7} copy
module.exports = {
  plugins: [
    "istanbul",
    [
      "canyon",
      {
        keepMap: false,
      },
    ],
  ],
};
```

## Prêt

Vérifiez maintenant l'objet window.coverage de la page, comme le montre la capture d'écran. Les données map ne sont plus présentes dans window.coverage,
ce qui peut considérablement réduire les coûts de transmission lors de la collecte de la couverture des tests d'automatisation UI.

![](https://cdn.jsdelivr.net/gh/canyon-project/assets/docs/static/jietu1.png)
