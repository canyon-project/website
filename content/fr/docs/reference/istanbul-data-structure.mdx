# Dictionnaire de Structure de Données de Couverture Istanbul.js

## Aperçu
Istanbul.js est la référence en matière de couverture de code JavaScript. Ce dictionnaire décrit les structures de données et les champs principaux de la couverture de code.

## Principales Structures de Données

### 1. Objet de Couverture
Structure de données de couverture de niveau supérieur, contenant les informations de couverture pour tous les fichiers.

```json
{
  "path/to/file.js": {
    // Objet FileCoverage
  }
}
```

### 2. FileCoverage (Couverture de Fichier)
Données de couverture complètes pour un seul fichier.

| Champ | Type | Description |
|------|------|------|
| `path` | string | Chemin absolu du fichier |
| `statementMap` | Object | Carte des instructions |
| `fnMap` | Object | Carte des fonctions |
| `branchMap` | Object | Carte des branches |
| `s` | Object | Comptage d'exécution des instructions |
| `f` | Object | Comptage d'appel des fonctions |
| `b` | Object | Comptage d'exécution des branches |

### 3. StatementMap (Carte des Instructions)
Décrit l'emplacement de chaque instruction dans le code.

| Champ | Type | Description |
|------|------|------|
| `start` | Location | Position de début de l'instruction |
| `end` | Location | Position de fin de l'instruction |

### 4. FunctionMap (Carte des Fonctions)
Décrit chaque fonction dans le code.

| Champ | Type | Description |
|------|------|------|
| `name` | string | Nom de la fonction ("(anonymous_N)" pour les fonctions anonymes) |
| `decl` | Location | Position de déclaration de la fonction |
| `loc` | Location | Position du corps de la fonction |
| `line` | number | Numéro de ligne de déclaration de la fonction |

### 5. BranchMap (Carte des Branches)
Décrit chaque branche dans le code.

| Champ | Type | Description |
|------|------|------|
| `loc` | Location | Position de la branche |
| `type` | string | Type de branche (if, switch, cond-expr, binary-expr) |
| `locations` | Array&lt;Location&gt; | Toutes les positions possibles de la condition de la branche |

### 6. Location (Informations d'Emplacement)
Décrit une position dans le code source.

| Champ | Type | Description |
|------|------|------|
| `start` | Position | Position de départ |
| `end` | Position | Position de fin |

### 7. Position (Position de Coordonnées)
Coordonnées spécifiques dans le code source.

| Champ | Type | Description |
|------|------|------|
| `line` | number | Numéro de ligne (commence à 1) |
| `column` | number | Numéro de colonne (commence à 0) |

## Objets Compteurs

### 8. Comptage d'Instructions
Enregistre le nombre d'exécutions de chaque instruction.

```json
{
  "0": 5,    // L'instruction ID 0 a été exécutée 5 fois
  "1": 0,    // L'instruction ID 1 n'a pas été exécutée
  "2": 3     // L'instruction ID 2 a été exécutée 3 fois
}
```

### 9. Comptage de Fonctions
Enregistre le nombre d'appels de chaque fonction.

```json
{
  "0": 2,    // La fonction ID 0 a été appelée 2 fois
  "1": 0,    // La fonction ID 1 n'a pas été appelée
  "2": 1     // La fonction ID 2 a été appelée 1 fois
}
```

### 10. Comptage de Branches
Enregistre le nombre d'exécutions de chaque condition de branche.

```json
{
  "0": [5, 2],    // 分支ID 0: true分支5次，false分支2次
  "1": [0, 3],    // 分支ID 1: true分支0次，false分支3次
  "2": [1, 1]     // 分支ID 2: 两个分支各执行1次
}
```

## 分支类型说明

### Branch Types (分支类型)

| 类型 | 描述 | 示例 |
|------|------|------|
| `if` | if语句 | `if (condition) { ... }` |
| `switch` | switch语句 | `switch (value) { case 1: ... }` |
| `cond-expr` | 三元运算符 | `condition ? value1 : value2` |
| `binary-expr` | 逻辑运算符 | `a && b`, `x \|\| y` |

## 报告摘要数据

### 11. Summary (摘要信息)
每种覆盖率类型的统计摘要。

| 字段 | 类型 | 描述 |
|------|------|------|
| `total` | number | 总数量 |
| `covered` | number | 已覆盖数量 |
| `skipped` | number | 跳过数量 |
| `pct` | number | 覆盖率百分比 |

### 12. Coverage Summary (覆盖率摘要)
文件或整体的覆盖率摘要。

| 字段 | 类型 | 描述 |
|------|------|------|
| `lines` | Summary | 行覆盖率摘要 |
| `functions` | Summary | 函数覆盖率摘要 |
| `statements` | Summary | 语句覆盖率摘要 |
| `branches` | Summary | 分支覆盖率摘要 |

## 实际示例

### math.js 文件内容
```javascript
function add(a, b) {
  return a + b;
}

function subtract(a, b) {
  if (a > b) {
    return a - b;
  } else {
    return b - a;
  }
}

function multiply(a, b) {
  return a * b;
}

function divide(a, b) {
  if (b === 0) {
    throw new Error('Division by zero');
  }
  return a / b;
}

module.exports = { add, subtract, multiply, divide };
```

### 完整的FileCoverage示例
```json
{
  "path": "/project/src/math.js",
  "statementMap": {
    "0": {"start": {"line": 1, "column": 0}, "end": {"line": 1, "column": 25}},
    "1": {"start": {"line": 2, "column": 2}, "end": {"line": 2, "column": 13}},
    "2": {"start": {"line": 5, "column": 0}, "end": {"line": 5, "column": 30}},
    "3": {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}},
    "4": {"start": {"line": 8, "column": 4}, "end": {"line": 8, "column": 15}},
    "5": {"start": {"line": 10, "column": 4}, "end": {"line": 10, "column": 15}},
    "6": {"start": {"line": 13, "column": 0}, "end": {"line": 13, "column": 25}},
    "7": {"start": {"line": 14, "column": 2}, "end": {"line": 14, "column": 13}},
    "8": {"start": {"line": 17, "column": 0}, "end": {"line": 17, "column": 30}},
    "9": {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}},
    "10": {"start": {"line": 20, "column": 4}, "end": {"line": 20, "column": 15}},
    "11": {"start": {"line": 22, "column": 4}, "end": {"line": 22, "column": 15}},
    "12": {"start": {"line": 25, "column": 0}, "end": {"line": 25, "column": 25}}
  },
  "fnMap": {
    "0": {
      "name": "add",
      "decl": {"start": {"line": 1, "column": 9}, "end": {"line": 1, "column": 12}},
      "loc": {"start": {"line": 1, "column": 20}, "end": {"line": 3, "column": 1}},
      "line": 1
    },
    "1": {
      "name": "subtract",
      "decl": {"start": {"line": 5, "column": 9}, "end": {"line": 5, "column": 17}},
      "loc": {"start": {"line": 5, "column": 25}, "end": {"line": 12, "column": 1}},
      "line": 5
    },
    "2": {
      "name": "multiply",
      "decl": {"start": {"line": 13, "column": 9}, "end": {"line": 13, "column": 16}},
      "loc": {"start": {"line": 13, "column": 24}, "end": {"line": 15, "column": 1}},
      "line": 13
    },
    "3": {
      "name": "divide",
      "decl": {"start": {"line": 17, "column": 9}, "end": {"line": 17, "column": 15}},
      "loc": {"start": {"line": 17, "column": 23}, "end": {"line": 24, "column": 1}},
      "line": 17
    }
  },
  "branchMap": {
    "0": {
      "loc": {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}},
      "type": "if",
      "locations": [
        {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}},
        {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}}
      ]
    },
    "1": {
      "loc": {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}},
      "type": "if",
      "locations": [
        {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}},
        {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}}
      ]
    }
  },
  "s": {"0": 1, "1": 1, "2": 1, "3": 1, "4": 3, "5": 2, "6": 1, "7": 1, "8": 1, "9": 1, "10": 1, "11": 1, "12": 1},
  "f": {"0": 5, "1": 3, "2": 2, "3": 1},
  "b": {"0": [3, 2], "1": [1, 0]}
}
```