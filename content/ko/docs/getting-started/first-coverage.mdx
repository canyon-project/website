import { Steps, Callout, Cards } from "nextra/components";

# 첫 번째 커버리지 데이터

> [!NOTE]
>
> Canyon은 [일반적인 프레임워크의 설치 가이드](/docs/installation/getting-started)를 제공하여 빠르게 시작할 수 있도록 도와줍니다.

다음 단계에 따라 첫 번째 커버리지 데이터 보고를 완료하세요:

## 새 프로젝트로 시작하기

<Steps>
  ### 설치

프론트엔드 엔지니어링 및 모듈식 개발에서 Babel은 필수적입니다. Babel 프로젝트의 경우 두 개의 Babel 플러그인만 설치하면 빠르게 시작할 수 있습니다.

```sh npm2yarn
npm install babel-plugin-istanbul babel-plugin-canyon -D
```

[Babel 설정 파일](https://babeljs.io/docs/config-files#configuration-file-types)에 [`istanbul`](https://www.npmjs.com/package/babel-plugin-istanbul)과 [`canyon`](https://www.npmjs.com/package/babel-plugin-canyon) 플러그인을 추가하세요:

  ```js filename="babel.config.js" {3,4} copy
  module.exports = {
    plugins: [
      'istanbul',
      'canyon'
      // 플러그인 순서에 주의하세요. canyon 플러그인은 istanbul 플러그인 뒤에 와야 합니다
      ],
  };
  ```

### 확인

설정이 완료되면 프로젝트를 시작하고 콘솔에서 **window.\_\_coverage\_\_**를 출력해보세요. 출력이 아래 이미지와 같다면 코드 계측이 성공적으로 이루어진 것입니다.

![coverage-canyon-console](https://cdn.jsdelivr.net/gh/canyon-project/assets/docs/static/docs/getting-started/first-coverage/coverage-canyon-console.png)

### CI 환경 변수 구성

CI 환경에서는 커버리지 데이터를 보고하기 위해 몇 가지 환경 변수를 구성해야 합니다.

> [!TIP]
>
> canyon은 컴파일 시 파이프라인 변수를 감지하며, 여러 [파이프라인 제공업체](/docs/reference/provider)를 지원합니다.<br/>
> 사용 중인 파이프라인 제공업체가 없나요? [명시적 구성](/docs/ecosystem/babel-plugin-canyon#配置)을 시도해보세요.


1. `DSN`과 `REPORTER`

- **DSN**: 커버리지 데이터 보고 서비스 주소, \{\{url\}\}/coverage/client, 여기서 \{\{url\}\}은 Canyon 서비스 주소입니다.
- **REPORTER**: 사용자 토큰, Canyon 사용자 설정 페이지에서 확인할 수 있습니다.

2. CI 플랫폼 변수 구성

![gitlab](https://cdn.jsdelivr.net/gh/canyon-project/assets/docs/static/docs/getting-started/first-coverage/gitlab-var-config.png)

<Callout type="info" emoji="ℹ️">
  프로젝트 ID, 브랜치 및 SHA는 수동으로 구성할 필요가 없습니다. Canyon 플러그인이 자동으로 파이프라인 환경 변수를 감지합니다.
</Callout>

  ### babel 플러그인 활성화 조건 업데이트

  __CI 단계에서는 프로덕션 브랜치에서 코드 계측을 방지하기 위해 플러그인 활성화 조건을 제어해야 합니다.__

  ```js {2,3} copy
  module.exports = {
    plugins: (process.env.CI &&
              process.env.CI_COMMIT_REF_NAME !== 'release')
              ? [
                'canyon',
                'istanbul'
              ]:[],
  };
  ```

  ### 커버리지 데이터 보고

  CI가 완료된 후 페이지가 테스트 환경에 배포됩니다.

  이때 커버리지 데이터는 브라우저에 저장됩니다. 사용자 조작이나 UI 자동화 테스트가 실행됨에 따라 window.__coverage___ 데이터가 계속 누적됩니다.

  이 데이터를 정확하게 Canyon 서버에 보고하면 커버리지 데이터를 실시간으로 표시할 수 있습니다.


  다음은 커버리지 데이터를 보고하는 몇 가지 방법입니다:

  <Cards>
  <Cards.Card
    title="UI 자동화 테스트"
    href="/docs/end-to-end-testing/playwright"
  />
  <Cards.Card
    title="수동 테스트"
    href="/docs/ecosystem/canyon-extension"
  />
</Cards>
</Steps>
