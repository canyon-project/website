# Playwright

Playwright에서는 컨텍스트를 가져와 테스트 케이스 실행 중에 커버리지 데이터를 로컬 파일에 저장하고, 마지막으로 canyon-uploader 도구를 사용하여 데이터를 집계하여 보고합니다.

## 커버리지 데이터를 로컬 파일에 저장하기

다음은 nodejs 코드 예시입니다:

```ts copy
import * as fs from 'fs';
import * as path from 'path';
import {test as baseTest} from '@playwright/test';

const canyonOutputDirPath = path.join(process.cwd(), '.canyon_output');

export const test = baseTest.extend({
  context: async ({context}, use) => {
    await context.addInitScript(() =>
      window.addEventListener('beforeunload', () =>
        (window as any).collectIstanbulCoverage((window as any).__coverage__)
      ),
    );
    await fs.promises.mkdir(canyonOutputDirPath, {recursive: true});
    await context.exposeFunction('collectIstanbulCoverage', (coverageJSON) => {
      console.log('Coverage collected',coverageJSON);
      if (coverageJSON) {
        fs.writeFileSync(path.join(canyonOutputDirPath, `coverage-final-${new Date().valueOf()}.json`), JSON.stringify(coverageJSON));
      }
    });
    await use(context);
    for (const page of context.pages()) {
      await page.evaluate(() => (window as any).collectIstanbulCoverage((window as any).__coverage__));
    }
  }
});

export const expect = test.expect;


```

## 집계 보고

canyon-uploader 도구를 사용하여 데이터를 집계하고 보고합니다. 자세한 사용 방법은 [canyon-uploader](/docs/ecosystem/canyon-uploader) 문서를 참조하세요.

```bash copy
./canyon-uploader map --dsn=https://canyonjs.org
```
