# istanbuljs 覆蓋率數據字典

## 概述
istanbuljs 是一個JavaScript代碼覆蓋率的黃金標準，本數據字典描述了覆蓋率數據的主要結構和字段。

## 主要數據結構

### 1. Coverage Object (覆蓋率對象)
頂級覆蓋率數據結構，包含所有文件的覆蓋率信息。

```json
{
  "path/to/file.js": {
    // FileCoverage 對象
  }
}
```

### 2. FileCoverage (文件覆蓋率)
單個文件的完整覆蓋率數據。

| 字段 | 類型 | 描述 |
|------|------|------|
| `path` | string | 文件的絕對路徑 |
| `statementMap` | Object | 語句映射表 |
| `fnMap` | Object | 函數映射表 |
| `branchMap` | Object | 分支映射表 |
| `s` | Object | 語句執行計數 |
| `f` | Object | 函數執行計數 |
| `b` | Object | 分支執行計數 |

### 3. StatementMap (語句映射)
描述代碼中每個語句的位置信息。

| 字段 | 類型 | 描述 |
|------|------|------|
| `start` | Location | 語句開始位置 |
| `end` | Location | 語句結束位置 |

### 4. FunctionMap (函數映射)
描述代碼中每個函數的信息。

| 字段 | 類型 | 描述 |
|------|------|------|
| `name` | string | 函數名稱（匿名函數為"(anonymous_N)"） |
| `decl` | Location | 函數聲明位置 |
| `loc` | Location | 函數體位置 |
| `line` | number | 函數聲明行號 |

### 5. BranchMap (分支映射)
描述代碼中每個分支的信息。

| 字段 | 類型 | 描述 |
|------|------|------|
| `loc` | Location | 分支位置 |
| `type` | string | 分支類型（if, switch, cond-expr, binary-expr） |
| `locations` | Array&lt;Location&gt; | 分支條件的所有可能位置 |

### 6. Location (位置信息)
描述源代碼中的位置。

| 字段 | 類型 | 描述 |
|------|------|------|
| `start` | Position | 開始位置 |
| `end` | Position | 結束位置 |

### 7. Position (坐標位置)
源代碼中的具體坐標。

| 字段 | 類型 | 描述 |
|------|------|------|
| `line` | number | 行號（從1開始） |
| `column` | number | 列號（從0開始） |

## 計數器對象

### 8. Statement Counters (語句計數器)
記錄每個語句的執行次數。

```json
{
  "0": 5,    // 語句ID 0 執行了5次
  "1": 0,    // 語句ID 1 未執行
  "2": 3     // 語句ID 2 執行了3次
}
```

### 9. Function Counters (函數計數器)
記錄每個函數的調用次數。

```json
{
  "0": 2,    // 函數ID 0 被調用了2次
  "1": 0,    // 函數ID 1 未被調用
  "2": 1     // 函數ID 2 被調用了1次
}
```

### 10. Branch Counters (分支計數器)
記錄每個分支條件的執行次數。

```json
{
  "0": [5, 2],    // 分支ID 0: true分支5次，false分支2次
  "1": [0, 3],    // 分支ID 1: true分支0次，false分支3次
  "2": [1, 1]     // 分支ID 2: 兩個分支各執行1次
}
```

## 分支類型說明

### Branch Types (分支類型)

| 類型 | 描述 | 示例 |
|------|------|------|
| `if` | if語句 | `if (condition) { ... }` |
| `switch` | switch語句 | `switch (value) { case 1: ... }` |
| `cond-expr` | 三元運算符 | `condition ? value1 : value2` |
| `binary-expr` | 邏輯運算符 | `a && b`, `x \|\| y` |

## 報告摘要數據

### 11. Summary (摘要信息)
每種覆蓋率類型的統計摘要。

| 字段 | 類型 | 描述 |
|------|------|------|
| `total` | number | 總數量 |
| `covered` | number | 已覆蓋數量 |
| `skipped` | number | 跳過數量 |
| `pct` | number | 覆蓋率百分比 |

### 12. Coverage Summary (覆蓋率摘要)
文件或整體的覆蓋率摘要。

| 字段 | 類型 | 描述 |
|------|------|------|
| `lines` | Summary | 行覆蓋率摘要 |
| `functions` | Summary | 函數覆蓋率摘要 |
| `statements` | Summary | 語句覆蓋率摘要 |
| `branches` | Summary | 分支覆蓋率摘要 |

## 實際示例

### math.js 文件內容
```javascript
function add(a, b) {
  return a + b;
}

function subtract(a, b) {
  if (a > b) {
    return a - b;
  } else {
    return b - a;
  }
}

function multiply(a, b) {
  return a * b;
}

function divide(a, b) {
  if (b === 0) {
    throw new Error('Division by zero');
  }
  return a / b;
}

module.exports = { add, subtract, multiply, divide };
```

### 完整的FileCoverage示例
```json
{
  "path": "/project/src/math.js",
  "statementMap": {
    "0": {"start": {"line": 1, "column": 0}, "end": {"line": 1, "column": 25}},
    "1": {"start": {"line": 2, "column": 2}, "end": {"line": 2, "column": 13}},
    "2": {"start": {"line": 5, "column": 0}, "end": {"line": 5, "column": 30}},
    "3": {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}},
    "4": {"start": {"line": 8, "column": 4}, "end": {"line": 8, "column": 15}},
    "5": {"start": {"line": 10, "column": 4}, "end": {"line": 10, "column": 15}},
    "6": {"start": {"line": 13, "column": 0}, "end": {"line": 13, "column": 25}},
    "7": {"start": {"line": 14, "column": 2}, "end": {"line": 14, "column": 13}},
    "8": {"start": {"line": 17, "column": 0}, "end": {"line": 17, "column": 30}},
    "9": {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}},
    "10": {"start": {"line": 20, "column": 4}, "end": {"line": 20, "column": 15}},
    "11": {"start": {"line": 22, "column": 4}, "end": {"line": 22, "column": 15}},
    "12": {"start": {"line": 25, "column": 0}, "end": {"line": 25, "column": 25}}
  },
  "fnMap": {
    "0": {
      "name": "add",
      "decl": {"start": {"line": 1, "column": 9}, "end": {"line": 1, "column": 12}},
      "loc": {"start": {"line": 1, "column": 20}, "end": {"line": 3, "column": 1}},
      "line": 1
    },
    "1": {
      "name": "subtract",
      "decl": {"start": {"line": 5, "column": 9}, "end": {"line": 5, "column": 17}},
      "loc": {"start": {"line": 5, "column": 25}, "end": {"line": 12, "column": 1}},
      "line": 5
    },
    "2": {
      "name": "multiply",
      "decl": {"start": {"line": 13, "column": 9}, "end": {"line": 13, "column": 16}},
      "loc": {"start": {"line": 13, "column": 24}, "end": {"line": 15, "column": 1}},
      "line": 13
    },
    "3": {
      "name": "divide",
      "decl": {"start": {"line": 17, "column": 9}, "end": {"line": 17, "column": 15}},
      "loc": {"start": {"line": 17, "column": 23}, "end": {"line": 24, "column": 1}},
      "line": 17
    }
  },
  "branchMap": {
    "0": {
      "loc": {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}},
      "type": "if",
      "locations": [
        {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}},
        {"start": {"line": 6, "column": 2}, "end": {"line": 6, "column": 25}}
      ]
    },
    "1": {
      "loc": {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}},
      "type": "if",
      "locations": [
        {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}},
        {"start": {"line": 18, "column": 2}, "end": {"line": 18, "column": 25}}
      ]
    }
  },
  "s": {"0": 1, "1": 1, "2": 1, "3": 1, "4": 3, "5": 2, "6": 1, "7": 1, "8": 1, "9": 1, "10": 1, "11": 1, "12": 1},
  "f": {"0": 5, "1": 3, "2": 2, "3": 1},
  "b": {"0": [3, 2], "1": [1, 0]}
}
```